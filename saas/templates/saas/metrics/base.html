{% extends "saas/base_dashboard.html" %}

{% block saas_title %}
{{title}} for {{organization.printable_name}}
{% endblock %}

{% block saas_content %}
<section id="metrics-container">
      <div id="metrics-table">
        <tabs v-model="currentTab" :transition-duration="0" @change="prepareCurrentTabData">
            <tab v-for="tab in tables" v-bind:title="tabTitle(tab)" v-bind:key="tab.key">
                <div class="date-chooser pull-right">
                  <span>To</span>
                  <select  class="form-control" v-model="timezone" @change="prepareCurrentTabData" style="display:inline-block; width:80px;">
                    <option value="local">Local</option>
                    <option value="utc">UTC</option>
                  </select>
                    <uiv-dropdown class="form-group" append-to-body menu-right>
                      <btn class="dropdown-toggle"><i class="fa fa-calendar"></i></btn>
                      <template slot="dropdown">
                        <li>
                          <uiv-date-picker
                            v-model="ends_at"
                            v-on:input="prepareCurrentTabData"
                            icon-control-left="fa fa-caret-left"
                            icon-control-right="fa fa-caret-right" />
                        </li>
                      </template>
                    </uiv-dropdown>
                  <span class="date">[[ends_at | formatDate('MMM D, Y')]]</span>
                </div>
                <div :id="'metrics-chart-' + tab.key" class="chart-content">
                </div>
                <!-- Display as a table -->
                <table>
                  <tr>
                    <td></td>
                    <td v-for="col in currentTableDates">[[col[0] | monthHeading]]</td>
                  </tr>
                  <tr v-for="row in currentTableData.data" :key="row.key">
                    <td v-if="row.location"><span :class="{ 'text-success': row.is_active, 'text-danger': !row.is_active }"><i class="fa fa-circle"></i></span> <a :href="row.location">[[row.key]]</a></td>
                    <td v-if="!row.location">[[row.key]]</td>
                    <td v-for="col in row.values" :key="col[0].toISOString()" :title="col[1]|humanizeCell(currentTableData.unit, currentTableData.scale, false)">[[col[1]|humanizeCell(currentTableData.unit, currentTableData.scale)]]</td>
                  </tr>
                  {% block metrics_extra_data %}
                  {% endblock %}
                </table>
            </tab>
        </tabs>
      </div>
  {% block metrics_extra_info %}
  {% endblock %}
</section>
{% endblock %}

{% block dashboard_bodyscripts %}
<script type="text/javascript">
function updateChart(container, data, unit, dataScale, extra) {
    $(container).text(JSON.stringify(data));
}

function updateBarChart(container, data, unit, dataScale, extra) {
    $(container).text(JSON.stringify(data));
}
</script>
{% endblock %}
