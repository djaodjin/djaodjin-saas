{% extends "saas/base_dashboard.html" %}

{% block saas_content %}
<div id="billing-statement-container">
  <div>
    <section id="info">
      <h1>Credit Card</h1>
      <a href="{{urls.organization.update_card}}">Update</a>
      <dl>
        <dt>card</dt>
        <dd id="last4">{% if last4 %}{{last4}}{% else %}N/A{% endif %}</dd>
      </dl>
      <dl>
        <dt>expires</dt>
        <dd id="exp_date">{% if exp_date %}{{exp_date}}{% else %}N/A{% endif %}</dd>
      </dl>
    </section>
    <section id="balance">
      <h1>Balance</h1>
      <div v-show="!itemsLoaded">Please wait...</div>
      <div v-show="itemsLoaded">
        {% if urls.organization.api_cancel_balance_due %}
        <button @click="modalOpen=true" v-cloak>cancel balance due</button>
        {% endif %}
        {% if urls.organization.vtcharge %}
        <a id="one-time-charge" href="{{urls.organization.vtcharge}}">one-time charge</a>
        {% endif %}
        <dl v-show="items.balance >= 0">
          <dt>[[items.balance | humanizeCell(items.unit, 0.01)]]</dt>
          <dd v-show="items.balance >= 0">
            {% spaceless %}
            Balance due
            <span v-if="items.balance > 0">
              (<a href="{{ urls.organization.balance }}">pay now</a>)
            </span>
            {% endspaceless %}
          </dd>
          <dd v-show="items.balance < 0">Balance Credits</dd>
        </dl>
      </div>
      {% if urls.organization.api_cancel_balance_due %}
      <!-- modal dialog for cancelling balance due -->
      <modal v-model="modalOpen" title="Cancel balance due">
            <p>
                Are you sure you would like to cancel the whole balance of [[items.balance | humanizeCell(items.unit, 0.01)]] ?
            </p>
            <div slot="footer">
                <button class="btn btn-default" @click.prevent="modalOpen=false">Cancel</button>
                <button class="btn btn-primary" @click.prevent="cancelBalance">OK</button>
            </div>
        </modal>
      <!-- end of modal dialog -->
      {% endif %}
    </section>
    {% include "saas/_transactions.html" %}
  </div>
</div>
{% endblock %}
